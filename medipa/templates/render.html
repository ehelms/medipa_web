{% extends "base.html" %}

{% block title %}Viewer{% endblock title %}

{% block header %}
<span id="image_name" data-id="{{ image_name }}">
  Viewer - {{ image_name }}
</span>
<button id="view_fullscreen" class="btn primary fr">View Fullscreen</button>
<button id="view_configurations" class="btn primary fr">Open Configurations</button>
{% endblock header %}

{% block stylesheets %}
	<link rel="stylesheet" href="/static/javascript/raytrace/style.css" type="text/css" media="screen" />
{% endblock stylesheets %}

{% block javascript %}
    <script type='text/javascript'>
       var MW = MW || {};
       {% autoescape off %}
       MW.manifest = $.parseJSON('{{ manifest }}');
       {% endautoescape %}   
    </script>        
	<script type='text/javascript' src='/static/javascript/raytrace/atvtdemo.js'></script>
	<script type='text/javascript' src='/static/javascript/raytrace/atvoltex.js'></script>
	<script type='text/javascript' src='/static/javascript/raytrace/J3DI.js'></script>
	<script type='text/javascript' src='/static/javascript/raytrace/J3DIMath.js'></script>
	<script type='text/javascript' src='/static/javascript/raytrace/webgl-utils.js'></script>
	<script type='text/javascript' src='/static/javascript/flot/jquery.flot.js'></script>
	<script type='text/javascript' src='/static/javascript/flot/jquery.flot.selection.js'></script>
	<script type='text/javascript' src='/static/javascript/medipa.js'></script>
	<script type='text/javascript' src='/static/javascript/configuration.js'></script>
	<script type='text/javascript' src='/static/javascript/graphs.js'></script>

		
    <script id="vshader" type="x-shader/x-vertex">// <![CDATA[
			attribute vec3 vPosition;
			varying vec3 v_Color;
			void main()
			{	    
				v_Color = vPosition;
				gl_Position = vec4(vPosition, 1.0);
			}
			// ]]&gt;
		</script>
		<script id="fshader" type="x-shader/x-fragment">
			#ifdef GL_ES
			precision mediump float;
			#endif
			varying vec3 v_Color;
			void main()
			{
				gl_FragColor = vec4(v_Color, 1.0);
			}
		</script>
{% endblock javascript %}

{% block content %}
<div data-url="/image/{{ image_name }}/?size={{ size }}" id="viewerContainer">
	<div>
    <span class="fl">
      <canvas id="webgl_canvas"><br />
        Your browser does not support the HTML 5 &lt;canvas&gt; element.<br />
      </canvas>
    </span>
    <div id="controls-container">
      <div class="slider-container">
        <div class="slider_wrapper" id="slider_first">
            Quality:
            <div>Auto:
                <input type="checkbox" id="auto_checkbox" checked/>
            </div>
            <div id="size-slider" class="slider_small"></div>
        </div>
        <div class="slider_wrapper">
            Opacity:
            <div id="opacity-slider"  class="slider"></div>
        </div>
        <div class="slider_wrapper">
            Brightness:
            <div id="bright-slider" class="slider"></div>
        </div>
        <div id="highlight_list_wrapper">
            Highlight list:
            <ul id="highlight_list">

            </ul>
        </div>
        <div class="slider_wrapper">
            Slicing: <a id="slice" onclick="resetSlice();">Reset</a>
            <div>
                <div class="slider_wrapper">
                    X
                    <div id="slice_x_slider" class="slider"></div>
                </div>
                <div class="slider_wrapper">
                    Y
                    <div id="slice_y_slider" class="slider"></div>
                </div>
                <div class="slider_wrapper">
                    Z
                    <div id="slice_z_slider" class="slider"></div>
                </div>
            </div>
        </div>

      </div>
      <div id="control" style="display: none;">

        <button type="button" style="-moz-user-select: -moz-none; -khtml-user-select: none; -webkit-user-select: none; -webkit-user-select: none;" onclick="toggleLinearFiltering();">HiQ</button> <span id="hiq" style="-moz-user-select: -moz-none; -khtml-user-select: none; -webkit-user-select: none; -webkit-user-select: none;"></span> 
        <button type="button" style="-moz-user-select: -moz-none; -khtml-user-select: none; -webkit-user-select: none; -webkit-user-select: none;" onclick="decreaseNumberOfSteps();">.</button>
        <button type="button" style="-moz-user-select: -moz-none; -khtml-user-select: none; -webkit-user-select: none; -webkit-user-select: none;" onclick="increaseNumberOfSteps();">&#8230;</button>
      </div>
      <div style="display:None;">
          <span style="display: inline-block; width: 33px; vertical-align: middle; -moz-user-select: -moz-none; -khtml-user-select: none; -webkit-user-select: none; -webkit-user-select: none;">Red</span>
          <canvas style="margin-top: 10px; border: 1px solid #202020; vertical-align: middle; -moz-user-select: -moz-none; -khtml-user-select: none; -webkit-user-select: none; -webkit-user-select: none;" id="canvas_red" width="522" height="42">
          </canvas>
          <button style="vertical-align: bottom; -moz-user-select: -moz-none; -khtml-user-select: none; -webkit-user-select: none; -webkit-user-select: none;" type="button" onclick="clear2D(0);">Reset</button><br />
          <span style="display: inline-block; width: 33px; vertical-align: middle; -moz-user-select: -moz-none; -khtml-user-select: none; -webkit-user-select: none; -webkit-user-select: none;">Green</span>
          <canvas style="margin-top: 10px; border: 1px solid #202020; vertical-align: middle; -moz-user-select: -moz-none; -khtml-user-select: none; -webkit-user-select: none; -webkit-user-select: none;" id="canvas_green" width="522" height="42">
          </canvas>
          <button style="vertical-align: bottom; -moz-user-select: -moz-none; -khtml-user-select: none; -webkit-user-select: none; -webkit-user-select: none;" type="button" onclick="clear2D(1);">Reset</button><br />
          <span style="display: inline-block; width: 33px; vertical-align: middle; -moz-user-select: -moz-none; -khtml-user-select: none; -webkit-user-select: none; -webkit-user-select: none;">Blue</span>
          <canvas style="margin-top: 10px; border: 1px solid #202020; vertical-align: middle; -moz-user-select: -moz-none; -khtml-user-select: none; -webkit-user-select: none; -webkit-user-select: none;" id="canvas_blue" width="522" height="42">
          </canvas>
          <button style="vertical-align: bottom; -moz-user-select: -moz-none; -khtml-user-select: none; -webkit-user-select: none; -webkit-user-select: none;" type="button" onclick="clear2D(2);">Reset</button><br />
          <span style="display: inline-block; width: 33px; vertical-align: middle; -moz-user-select: -moz-none; -khtml-user-select: none; -webkit-user-select: none; -webkit-user-select: none;">Alpha
          </span>
          <canvas style="margin-top: 10px; border: 1px solid #202020; vertical-align: middle; -moz-user-select: -moz-none; -khtml-user-select: none; -webkit-user-select: none; -webkit-user-select: none;" id="canvas_alpha" width="522" height="42">
          </canvas>
          <button style="vertical-align: bottom; -moz-user-select: -moz-none; -khtml-user-select: none; -webkit-user-select: none; -webkit-user-select: none;" type="button" onclick="clear2D(3);">Reset
          </button>
      </div>
    <div id="graphsContainer">
      <div id="placeholder" data-url="/image/{{ image_name }}/histogram/" style="width:600px;height:300px;"></div>
      <button id="zoom_histogram" class="btn fl">Zoom to Selection</button>
      <button id="zoom_reset" class="btn default fl">Reset Zoom</button>
      <button id="highlight_selected" class="btn fl">Save Selected Highlight</button>
    </div>
    <div id="picker">

    </div>
    <span id="fps"></span>

  </div>

  <div id="configurationContainer" class="clear hide">
    <div class="container-fluid">
      <div class="actions well">
        <div class="alert-message success hide" id="configuration_alert_success">
          <a class="close" href="#">x</a>
          <p>
            <strong>Success!</strong>
            The configuration was successfully saved.
          </p>
        </div>
        <div class="alert-message error hide" id="configuration_alert_error">
          <a class="close" href="#">x</a>
          <p>
            <strong>Error!</strong>
            <span id="configuration_alert_error_message"></span>
          </p>
        </div>
        <span class="clearfix">
          <label>Name: </label>
          <input type='text' name='configuration_name' id='configuration_name' class="xlarge">
        </span>
        <button id="save_configuration" class="btn primary" data-url="/image/{{ image_name }}/configuration/">Save Current Configuration</button>
      </div>
      <table class="zebra-striped">
        <thead>
          <tr>
            <th>Configuration</th>
            <th>Select Configuration</th>
            <th>Delete Configuration</th>
          </tr>
        </thead>
        <tbody id="configuration_table">
          {% for name, configuration in configurations.iteritems() %}
          <tr id="config_{{ name }}">
            <td>{{ name }}</td>
            <td><button class="config_link btn success" data-url="/image/{{ image_name }}/configuration/{{ name }}/">Load</a></td>
            <td><button class="config_delete_link btn danger" data-url="/image/{{ image_name }}/configuration/{{ name }}/">Delete</a></td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<div id="hidden"></div>
{% endblock content %}
